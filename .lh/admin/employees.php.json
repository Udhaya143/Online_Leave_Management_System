{
    "sourceFile": "admin/employees.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1762710714104,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1762710885644,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,20 +4,21 @@\n if(!isset($_SESSION['alogin'])) { header('Location:index.php'); exit(); }\n \n // Add employee\n if(isset($_POST['add'])) {\n-    $fullname = trim($_POST['fullname']);\n-    $email = trim($_POST['email']);\n-    $gender = trim($_POST['gender']);\n-    $department = trim($_POST['department']);\n-    $password = md5($_POST['password']); // secure hash\n+    $fullname   = trim($_POST['fullname']);\n+    $email      = trim($_POST['email']);\n+    $gender     = trim($_POST['gender']);      // (not stored in DB in current schema)\n+    $department = trim($_POST['department']);  // (not stored in DB in current schema)\n+    $password   = md5($_POST['password']);     // hash to match login\n \n-    if (!empty($fullname) && !empty($email) && !empty($_POST['password'])) {\n-        $sql = \"INSERT INTO tblemployees (FullName, Email, Password) VALUES(:fullname, :email, :password)\";\n+    if ($fullname !== '' && $email !== '' && $_POST['password'] !== '') {\n+        $sql = \"INSERT INTO tblemployees (FullName, Email, Password)\n+                VALUES (:fullname, :email, :password)\";\n         $stmt = $dbh->prepare($sql);\n-        $stmt->bindParam(':fullname',$fullname);\n-        $stmt->bindParam(':email',$email);\n-        $stmt->bindParam(':password',$password);\n+        $stmt->bindParam(':fullname', $fullname);\n+        $stmt->bindParam(':email',    $email);\n+        $stmt->bindParam(':password', $password);\n         $stmt->execute();\n         $msg = \"‚úÖ Employee added successfully\";\n     } else {\n         $error = \"‚ö†Ô∏è Please fill in all required fields.\";\n@@ -26,14 +27,17 @@\n \n // Delete employee\n if(isset($_GET['del'])) {\n     $id = intval($_GET['del']);\n-    $dbh->prepare(\"DELETE FROM tblemployees WHERE id=:id\")->execute([':id'=>$id]);\n+    $del = $dbh->prepare(\"DELETE FROM tblemployees WHERE id=:id\");\n+    $del->bindParam(':id', $id);\n+    $del->execute();\n     $msg = \"üóëÔ∏è Employee record deleted successfully\";\n }\n \n-// Fetch all employees\n-$rows = $dbh->query(\"SELECT * FROM tblemployees ORDER BY id DESC\")->fetchAll();\n+// Fetch all employees as associative arrays (so we can use $row['...'])\n+$rows = $dbh->query(\"SELECT id, FullName, Email, RegDate FROM tblemployees ORDER BY id DESC\")\n+            ->fetchAll(PDO::FETCH_ASSOC);\n ?>\n <!doctype html>\n <html>\n <head>\n@@ -61,32 +65,37 @@\n .del{background:#e53935;padding:6px 10px;color:#fff;border-radius:6px;border:0;cursor:pointer}\n </style>\n </head>\n <body>\n-<div class=\"header\"><div style=\"font-weight:700\">OLMS Admin Panel</div><div>Welcome, <?php echo htmlentities($_SESSION['alogin']); ?> | <a href=\"logout.php\" style=\"color:#fff;text-decoration:none;\">Logout</a></div></div>\n+<div class=\"header\">\n+  <div style=\"font-weight:700\">OLMS Admin Panel</div>\n+  <div>Welcome, <?php echo htmlentities($_SESSION['alogin']); ?> | <a href=\"logout.php\" style=\"color:#fff;text-decoration:none;\">Logout</a></div>\n+</div>\n+\n <div class=\"wrapper\">\n   <nav class=\"sidebar\">\n     <a href=\"dashboard.php\">üè† Dashboard</a>\n     <a href=\"employees.php\" class=\"active\">üë• Employees</a>\n     <a href=\"leave-types.php\">üìÑ Leave Types</a>\n     <a href=\"manage-leaves.php\">üìã Manage Leaves</a>\n   </nav>\n+\n   <main class=\"main\">\n     <div class=\"card\">\n       <h2>‚ûï Add New Employee</h2>\n-      <?php \n-      if(isset($msg)) echo \"<div class='msg'>$msg</div>\";\n-      if(isset($error)) echo \"<div class='error'>$error</div>\";\n+      <?php\n+        if(isset($msg))   echo \"<div class='msg'>\".htmlentities($msg).\"</div>\";\n+        if(isset($error)) echo \"<div class='error'>\".htmlentities($error).\"</div>\";\n       ?>\n       <form method=\"post\" class=\"grid\">\n-        <input name=\"fullname\" placeholder=\"Full Name\" required>\n-        <input name=\"email\" type=\"email\" placeholder=\"Email\" required>\n-        <select name=\"gender\" required>\n+        <input name=\"fullname\"    placeholder=\"Full Name\" required>\n+        <input name=\"email\"       type=\"email\" placeholder=\"Email\" required>\n+        <select name=\"gender\"     required>\n           <option value=\"\">Gender</option>\n           <option>Male</option>\n           <option>Female</option>\n         </select>\n-        <input name=\"department\" placeholder=\"Department\" required>\n+        <input name=\"department\"  placeholder=\"Department\" required>\n         <input type=\"password\" name=\"password\" placeholder=\"Set Password\" required>\n         <button name=\"add\" type=\"submit\" style=\"grid-column:span 2;\">Add Employee</button>\n       </form>\n     </div>\n@@ -97,23 +106,24 @@\n         <thead>\n           <tr><th>#</th><th>Full Name</th><th>Email</th><th>Reg Date</th><th>Action</th></tr>\n         </thead>\n         <tbody>\n-          <?php \n+          <?php\n           if ($rows) {\n-            $cnt=1;\n-            foreach($rows as $row){ \n-              echo \"<tr>\n-                      <td>$cnt</td>\n-                      <td>{$row['FullName']}</td>\n-                      <td>{$row['Email']}</td>\n-                      <td>{$row['RegDate'] ?? date('Y-m-d H:i:s')}</td>\n-                      <td><a href='employees.php?del={$row['id']}'><button class='del'>Delete</button></a></td>\n-                    </tr>\";\n-              $cnt++;\n-            }\n+              $cnt = 1;\n+              foreach ($rows as $row) {\n+                  $regDate = !empty($row['RegDate']) ? $row['RegDate'] : date('Y-m-d H:i:s');\n+                  echo '<tr>'.\n+                       '<td>'. $cnt .'</td>'.\n+                       '<td>'. htmlentities($row['FullName']) .'</td>'.\n+                       '<td>'. htmlentities($row['Email']) .'</td>'.\n+                       '<td>'. htmlentities($regDate) .'</td>'.\n+                       '<td><a href=\"employees.php?del='. intval($row['id']) .'\" onclick=\"return confirm(\\'Delete this employee?\\')\"><button class=\"del\">Delete</button></a></td>'.\n+                       '</tr>';\n+                  $cnt++;\n+              }\n           } else {\n-            echo \"<tr><td colspan='5'>No employees found.</td></tr>\";\n+              echo \"<tr><td colspan='5'>No employees found.</td></tr>\";\n           }\n           ?>\n         </tbody>\n       </table>\n"
                }
            ],
            "date": 1762710714104,
            "name": "Commit-0",
            "content": "<?php\nsession_start();\ninclude('../includes/config.php');\nif(!isset($_SESSION['alogin'])) { header('Location:index.php'); exit(); }\n\n// Add employee\nif(isset($_POST['add'])) {\n    $fullname = trim($_POST['fullname']);\n    $email = trim($_POST['email']);\n    $gender = trim($_POST['gender']);\n    $department = trim($_POST['department']);\n    $password = md5($_POST['password']); // secure hash\n\n    if (!empty($fullname) && !empty($email) && !empty($_POST['password'])) {\n        $sql = \"INSERT INTO tblemployees (FullName, Email, Password) VALUES(:fullname, :email, :password)\";\n        $stmt = $dbh->prepare($sql);\n        $stmt->bindParam(':fullname',$fullname);\n        $stmt->bindParam(':email',$email);\n        $stmt->bindParam(':password',$password);\n        $stmt->execute();\n        $msg = \"‚úÖ Employee added successfully\";\n    } else {\n        $error = \"‚ö†Ô∏è Please fill in all required fields.\";\n    }\n}\n\n// Delete employee\nif(isset($_GET['del'])) {\n    $id = intval($_GET['del']);\n    $dbh->prepare(\"DELETE FROM tblemployees WHERE id=:id\")->execute([':id'=>$id]);\n    $msg = \"üóëÔ∏è Employee record deleted successfully\";\n}\n\n// Fetch all employees\n$rows = $dbh->query(\"SELECT * FROM tblemployees ORDER BY id DESC\")->fetchAll();\n?>\n<!doctype html>\n<html>\n<head>\n<meta charset=\"utf-8\">\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\">\n<title>Manage Employees | OLMS Admin</title>\n<style>\nbody{font-family:'Segoe UI',Arial;margin:0;background:#f5f7f8}\n.header{background:#004d40;color:#fff;padding:14px 24px;display:flex;justify-content:space-between;align-items:center}\n.wrapper{display:flex}\n.sidebar{width:240px;background:#263238;color:#fff;min-height:calc(100vh - 56px);padding-top:24px}\n.sidebar a{display:block;color:#fff;padding:12px 18px;text-decoration:none}\n.sidebar a:hover,.sidebar a.active{background:#00796b}\n.main{flex:1;padding:30px}\n.card{background:#fff;padding:25px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.06);margin-bottom:25px}\nform.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}\ninput,select{padding:10px;border-radius:8px;border:1px solid #ccc}\nbutton{padding:10px;border-radius:8px;border:0;background:#00796b;color:#fff;cursor:pointer}\nbutton:hover{background:#00695c}\n.table{width:100%;border-collapse:collapse;margin-top:16px}\n.table th{background:#00796b;color:#fff;padding:12px}\n.table td{padding:10px;border-bottom:1px solid #eee;text-align:center}\n.msg{padding:10px;background:#e0f2f1;color:#004d40;border-radius:8px;margin-bottom:10px;text-align:center}\n.error{padding:10px;background:#ffebee;color:#b71c1c;border-radius:8px;margin-bottom:10px;text-align:center}\n.del{background:#e53935;padding:6px 10px;color:#fff;border-radius:6px;border:0;cursor:pointer}\n</style>\n</head>\n<body>\n<div class=\"header\"><div style=\"font-weight:700\">OLMS Admin Panel</div><div>Welcome, <?php echo htmlentities($_SESSION['alogin']); ?> | <a href=\"logout.php\" style=\"color:#fff;text-decoration:none;\">Logout</a></div></div>\n<div class=\"wrapper\">\n  <nav class=\"sidebar\">\n    <a href=\"dashboard.php\">üè† Dashboard</a>\n    <a href=\"employees.php\" class=\"active\">üë• Employees</a>\n    <a href=\"leave-types.php\">üìÑ Leave Types</a>\n    <a href=\"manage-leaves.php\">üìã Manage Leaves</a>\n  </nav>\n  <main class=\"main\">\n    <div class=\"card\">\n      <h2>‚ûï Add New Employee</h2>\n      <?php \n      if(isset($msg)) echo \"<div class='msg'>$msg</div>\";\n      if(isset($error)) echo \"<div class='error'>$error</div>\";\n      ?>\n      <form method=\"post\" class=\"grid\">\n        <input name=\"fullname\" placeholder=\"Full Name\" required>\n        <input name=\"email\" type=\"email\" placeholder=\"Email\" required>\n        <select name=\"gender\" required>\n          <option value=\"\">Gender</option>\n          <option>Male</option>\n          <option>Female</option>\n        </select>\n        <input name=\"department\" placeholder=\"Department\" required>\n        <input type=\"password\" name=\"password\" placeholder=\"Set Password\" required>\n        <button name=\"add\" type=\"submit\" style=\"grid-column:span 2;\">Add Employee</button>\n      </form>\n    </div>\n\n    <div class=\"card\">\n      <h2>üìã All Employees</h2>\n      <table class=\"table\">\n        <thead>\n          <tr><th>#</th><th>Full Name</th><th>Email</th><th>Reg Date</th><th>Action</th></tr>\n        </thead>\n        <tbody>\n          <?php \n          if ($rows) {\n            $cnt=1;\n            foreach($rows as $row){ \n              echo \"<tr>\n                      <td>$cnt</td>\n                      <td>{$row['FullName']}</td>\n                      <td>{$row['Email']}</td>\n                      <td>{$row['RegDate'] ?? date('Y-m-d H:i:s')}</td>\n                      <td><a href='employees.php?del={$row['id']}'><button class='del'>Delete</button></a></td>\n                    </tr>\";\n              $cnt++;\n            }\n          } else {\n            echo \"<tr><td colspan='5'>No employees found.</td></tr>\";\n          }\n          ?>\n        </tbody>\n      </table>\n    </div>\n  </main>\n</div>\n</body>\n</html>\n"
        }
    ]
}